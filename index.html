<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lye, Dye, and DIY — Beginner Soap Calculator</title>
<link rel="manifest" href="manifest.json" />
<link rel="icon" sizes="192x192" href="icons/icon-192.png" />
<link rel="icon" sizes="512x512" href="icons/icon-512.png" />
<meta name="theme-color" content="#4CAF50" />
<style>
:root{
  --bg:#fafafa;--card:#fff;--ink:#222;--muted:#666;--brand:#4CAF50;
  --ok:#2e7d32;--warn:#e65100;--danger:#c62828;--sh:0 2px 12px rgba(0,0,0,.08)
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
header{padding:22px 16px;text-align:center}
h1{margin:.1rem 0 2px;font-size:28px}
h2{margin:0;color:var(--muted);font-size:14px;font-weight:500}
main{max-width:1120px;margin:0 auto;padding:0 16px 40px}
.card{background:var(--card);border-radius:14px;box-shadow:var(--sh);padding:14px}
.grid{display:grid;gap:12px}
.grid-2{grid-template-columns:1fr}
@media(min-width:980px){.grid-2{grid-template-columns:1fr 1fr}}
label{font-weight:700}
input,select,textarea{width:100%;padding:10px 12px;border:1px solid #e2e2e2;border-radius:10px;font-size:16px}
table{width:100%;border-collapse:separate;border-spacing:0 8px}
th,td{padding:6px 8px;text-align:left}
th{font-size:14px}
.btn{appearance:none;border:0;border-radius:10px;background:var(--brand);color:#fff;padding:10px 14px;font-weight:700;cursor:pointer}
.btn.subtle{background:#efefef;color:#222}
.btn.danger{background:var(--danger)}
.row{display:flex;gap:8px;flex-wrap:wrap}
.mini{font-size:12px;color:var(--muted)}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
.hr{height:1px;background:#eee;margin:10px 0}
.badge{font-weight:800}
.ok{color:var(--ok)} .warn{color:var(--warn)} .danger{color:var(--danger)}
.tabbar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.tabbar .tab{padding:8px 12px;border-radius:10px;background:#eee;cursor:pointer;font-weight:700}
.tabbar .tab.active{background:var(--brand);color:#fff}
footer{max-width:1120px;margin:16px auto;padding:0 16px;color:#777;font-size:13px;text-align:center}
.kvs{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.warnline{padding:8px;border-radius:10px;background:#fff7e6;border:1px solid #ffd699}
.dangerline{padding:8px;border-radius:10px;background:#ffecec;border:1px solid #ffb3b3}
.watermark{position:fixed;bottom:12px;left:12px;font-size:12px;opacity:.35;pointer-events:none}
</style>
</head>
<body>
<header>
  <h1>Lye, Dye, and DIY</h1>
  <h2>Bel Lei’s Soaps N Stuffs • Beginner-friendly, pro-accurate calculator</h2>
</header>

<main class="grid">
  <!-- Tabs -->
  <div class="card">
    <div class="tabbar">
      <div class="tab active" data-tab="calc">Calculator</div>
      <div class="tab" data-tab="lyelimited">Lye-Limited</div>
      <div class="tab" data-tab="cost">Cost & Profit</div>
      <div class="tab" data-tab="layers">Layer Helper</div>
      <div class="tab" data-tab="save">Save / Load</div>
      <div class="tab" data-tab="feedback">Feedback</div>
      <div class="tab" id="installBtn" title="Install App">Install App</div>
      <button class="btn subtle" id="printBtn" style="margin-left:auto">Print</button>
      <button class="btn subtle" id="exportBtn">Export JSON</button>
    </div>
  </div>

  <!-- CALCULATOR -->
  <section class="card grid" id="tab-calc">
    <h3 style="margin:0">Calculator</h3>

    <div class="card">
      <div class="row">
        <div style="flex:1;min-width:220px">
          <label>Desired total oils (g)</label>
          <input type="number" id="targetOilsG" value="1000" min="100" step="10" />
        </div>
        <div style="flex:1;min-width:220px">
          <label>Recipe profile</label>
          <select id="profileSelect">
            <option value="palmFreeBalanced">Palm-Free Balanced (45/30/15/10)</option>
            <option value="lardBalanced">Lard Balanced (Olive/Lard/Coconut/Shea/Castor)</option>
          </select>
        </div>
        <div style="align-self:flex-end">
          <button class="btn subtle" id="applyProfileBtn" type="button">Apply profile to oils</button>
        </div>
      </div>
      <div class="mini">Tip: Enter a target (e.g., 750 g, 1400 g) then “Apply profile” to auto-fill each oil.</div>
    </div>

    <div>
      <table>
        <thead><tr><th>Oil</th><th style="width:28%">Weight (g)</th><th style="width:18%">Remove</th></tr></thead>
        <tbody id="oilTbody"></tbody>
      </table>
      <button class="btn subtle" id="addOilBtn" type="button">+ Add oil</button>
      <div class="mini">Enter oil weights in grams. Ounces & totals show in results.</div>
    </div>

    <div class="grid grid-2">
      <div class="card grid">
        <label>Lye Type</label>
        <select id="lyeType"><option value="NaOH">NaOH (bar)</option><option value="KOH">KOH (liquid/cream)</option></select>
        <label>Lye Purity (%)</label><input type="number" id="lyePurity" value="100" min="80" max="100" />
        <label>Superfat / Lye Discount (%)</label><input type="number" id="superfat" value="5" min="0" max="15" />
      </div>

      <div class="card grid">
        <label>Water Mode</label>
        <select id="waterMode"><option value="ratio">Water : Lye ratio</option><option value="conc">Lye solution concentration %</option></select>
        <div id="waterRatioWrap"><label>Water : Lye</label><input type="number" id="waterRatio" value="2.5" step="0.1" /></div>
        <div id="waterConcWrap" style="display:none"><label>Lye concentration (%)</label><input type="number" id="lyeConc" value="30" min="20" max="50" /><div class="mini">Common CP range 28–33% (higher = less water)</div></div>
        <label>Milk replacement (% of liquid)</label><input type="number" id="milkPct" value="0" min="0" max="100" />
        <div class="mini">Using milk? Freeze slushy & keep solution cool to avoid scorching.</div>
      </div>
    </div>

    <div class="grid grid-2">
      <div class="card grid">
        <h4 style="margin:0">Additives (% of oils unless noted)</h4>
        <label>Fragrance / EO %</label><input type="number" id="foPct" value="3" step="0.1" />
        <label>Sodium Lactate % (add to water)</label><input type="number" id="lactatePct" placeholder="1–3%" />
        <label>Salt %</label><input type="number" id="saltPct" placeholder="0–3%" />
        <label>Sugar %</label><input type="number" id="sugarPct" placeholder="0–3%" />
        <label>Clays total %</label><input type="number" id="clayPct" placeholder="0–2%" />
        <label>Honey %</label><input type="number" id="honeyPct" placeholder="0–3%" />
        <label>Activated Charcoal %</label><input type="number" id="charcoalPct" placeholder="0–1%" />
        <label>Sodium Citrate %</label><input type="number" id="citratePct" placeholder="0–1%" />
      </div>

      <div class="card grid">
        <h4 style="margin:0">Colorants & Botanicals (tsp PPO)</h4>
        <label>Colorant tsp PPO</label><input type="number" id="colorTsp" placeholder="e.g., 1.0" />
        <label>Botanicals tsp PPO</label><input type="number" id="botTsp" placeholder="e.g., 0.5" />
        <label>Capacity Check — pot / crockpot (mL)</label><input type="number" id="potCapacity" placeholder="optional" />
        <div class="mini">Safety guidance: aim for ~60–75% of vessel volume to allow expansion.</div>
      </div>
    </div>

    <div class="row">
      <button class="btn" id="calcBtn" type="button">Calculate</button>
      <button class="btn subtle" id="resetBtn" type="button">Reset</button>
    </div>

    <div class="hr"></div>

    <section id="resultsCard" class="card" style="display:none">
      <h3 style="margin:0 0 8px">Results</h3>
      <div class="kvs">
        <div><b>Total oils</b><div class="mono" id="totOils">—</div></div>
        <div><b>Total oils (oz)</b><div class="mono" id="totOilsOz">—</div></div>
        <div><b>Lye (theoretical)</b><div class="mono" id="lyeTheo">—</div></div>
        <div><b>Purity-adjusted</b><div class="mono" id="lyeAdj">—</div></div>
        <div><b>Lye after superfat</b><div class="mono" id="lyeFinal">—</div></div>
        <div><b>Lye (oz)</b><div class="mono" id="lyeFinalOz">—</div></div>
        <div><b>Total liquid</b><div class="mono" id="liqTotal">—</div></div>
        <div><b>Total liquid (oz)</b><div class="mono" id="liqTotalOz">—</div></div>
        <div><b>Water portion</b><div class="mono" id="waterNeed">—</div></div>
        <div><b>Milk portion</b><div class="mono" id="milkNeed">—</div></div>
        <div><b>Additives total</b><div class="mono" id="addsTot">—</div></div>
        <div><b>Fragrance need</b><div class="mono" id="fragNeed">—</div></div>
        <div><b>Batch total (approx)</b><div class="mono" id="batchTot">—</div></div>
        <div><b>Batch total (oz)</b><div class="mono" id="batchTotOz">—</div></div>
        <div><b>Recommended pot fill (60–75%)</b><div class="mono" id="fillRange">N/A</div></div>
        <div><b>Status</b><div class="mono badge" id="capStatus">—</div></div>
      </div>
      <div class="hr"></div>
      <div id="warnBox" class="mini"></div>
    </section>
  </section>

  <!-- LYE-LIMITED -->
  <section class="card grid" id="tab-lyelimited" style="display:none">
    <h3 style="margin:0">Lye-Limited Mode (I only have X lye)</h3>
    <div class="grid grid-2">
      <div class="card grid">
        <label>Lye available (g)</label><input type="number" id="availLye" placeholder="e.g., 228" />
        <label>Recipe profile</label>
        <select id="llProfile">
          <option value="palmFreeBalanced">Palm-Free Balanced (45/30/15/10)</option>
          <option value="lardBalanced">Lard Balanced (Olive/Lard/Coconut/Shea/Castor)</option>
        </select>
        <label>Lye Type</label><select id="llLyeType"><option value="NaOH">NaOH</option><option value="KOH">KOH</option></select>
        <label>Lye Purity (%)</label><input type="number" id="llPurity" value="100" min="80" max="100" />
        <label>Superfat (%)</label><input type="number" id="llSF" value="5" min="0" max="15" />
        <label>Water : Lye</label><input type="number" id="llWaterRatio" value="2.5" step="0.1" />
        <button class="btn" id="makeFromLye">Compute Oils from Lye</button>
      </div>
      <div class="card">
        <h4 style="margin:0 0 8px">Result (auto-fills Oils table)</h4>
        <div class="mini">We compute weighted average SAP from your profile and back-solve total oils.</div>
        <div id="llOut" class="mono" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <!-- COST / PROFIT -->
  <section class="card grid" id="tab-cost" style="display:none">
    <h3 style="margin:0 0 8px">Cost & Profit</h3>
    <div class="mini">Enter your ingredient prices (per gram). We’ll total the batch and suggest pricing.</div>
    <table>
      <thead><tr><th>Item</th><th>Price per gram ($)</th><th>Remove</th></tr></thead>
      <tbody id="costTbody"></tbody>
    </table>
    <div class="row">
      <button class="btn subtle" id="addCostItem">+ Add Cost Item</button>
      <button class="btn" id="calcCost">Calculate Cost</button>
    </div>
    <div class="hr"></div>
    <div id="costResults" class="mono"></div>
    <div class="row" style="margin-top:8px">
      <div style="flex:1;min-width:220px"><label>Planned bar weight (g)</label><input type="number" id="barG" value="113" /></div>
      <div style="flex:1;min-width:220px"><label>Desired margin (%)</label><input type="number" id="marginPct" value="60" /></div>
    </div>
    <div id="priceSuggest" class="mono" style="margin-top:8px"></div>
  </section>

  <!-- LAYER HELPER -->
  <section class="card grid" id="tab-layers" style="display:none">
    <h3 style="margin:0 0 8px">Layer Helper (CP)</h3>
    <div class="grid grid-2">
      <div class="card grid">
        <label>Number of layers</label><input type="number" id="numLayers" value="3" min="2" max="10" />
        <label>Fragrance behavior</label>
        <select id="foBehavior">
          <option value="normal">Normal / No acceleration</option>
          <option value="med">Medium acceleration</option>
          <option value="fast">Fast acceleration</option>
        </select>
        <label>Working temp (°F)</label><input type="number" id="workTemp" value="105" />
        <button class="btn" id="genLayerPlan">Generate Timing</button>
      </div>
      <div class="card">
        <h4 style="margin:0 0 8px">Suggested timing</h4>
        <div id="layerPlan" class="mono"></div>
      </div>
    </div>
    <div class="mini">Rule of thumb: wait until the layer just “skins” (holds a spoon trail) before pouring the next.</div>
  </section>

  <!-- SAVE / LOAD -->
  <section class="card grid" id="tab-save" style="display:none">
    <h3 style="margin:0 0 8px">Save / Load Recipes (local)</h3>
    <div class="row">
      <div style="flex:1;min-width:220px"><label>Recipe name</label><input id="saveName" placeholder="e.g., Neapolitan 6qt" /></div>
      <button class="btn" id="saveLocal">Save</button>
      <div style="flex:1;min-width:220px"><label>Load</label><select id="loadSelect"></select></div>
      <button class="btn subtle" id="loadLocal">Load</button>
      <button class="btn danger" id="deleteLocal">Delete</button>
    </div>
  </section>

  <!-- FEEDBACK -->
  <section class="card grid" id="tab-feedback" style="display:none">
    <h3 style="margin:0 0 8px">Beta Feedback</h3>
    <div class="grid">
      <label>Would you recommend this calculator?</label>
      <select id="fbRecommend"><option>Yes</option><option>No</option></select>
      <label>Comments</label><textarea id="fbComments" rows="5" placeholder="What works great? What’s confusing?"></textarea>
      <div class="row">
        <button class="btn" id="exportFeedback">Export feedback JSON</button>
        <button class="btn subtle" id="copyFeedback">Copy to clipboard</button>
      </div>
    </div>
    <div class="mini">For privacy, this app stores feedback **only on device** unless users export/copy it.</div>
  </section>
</main>

<p class="watermark">Bel Lei’s Soaps N Stuffs — Lye, Dye, and DIY™</p>

<footer>
  © 2025 Bel Lei’s Soaps N Stuffs • Educational tool; verify critical batches with a trusted lye calc.